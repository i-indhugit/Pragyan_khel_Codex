<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Temporal Error Detector</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="40" height="40" rx="8" fill="#4F46E5"/>
                        <path d="M12 15L20 10L28 15V25L20 30L12 25V15Z" stroke="white" stroke-width="2" fill="none"/>
                        <circle cx="20" cy="20" r="3" fill="white"/>
                    </svg>
                    <h1>Video Temporal Error Detector</h1>
                </div>
                <button class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <p class="tagline">Detect frame drops & merges in your videos instantly</p>
        </header>

        <!-- Upload Section -->
        <section class="upload-section" id="uploadSection">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M32 44V20M32 20L22 30M32 20L42 30" stroke="#4F46E5" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M52 44V48C52 50.2091 50.2091 52 48 52H16C13.7909 52 12 50.2091 12 48V44" stroke="#4F46E5" stroke-width="3" stroke-linecap="round"/>
                    </svg>
                </div>
                <h2>Upload Your Video</h2>
                <p>Drag & drop or click to browse</p>
                <p class="file-types">Supported: MP4, AVI, MOV, MKV (max 50MB)</p>
                <input type="file" id="videoInput" accept="video/mp4,video/avi,video/quicktime,video/x-matroska" hidden>
                <button class="btn btn-primary" id="browseBtn">Browse Video</button>
                <button class="btn btn-secondary" id="demoBtn" style="margin-top: 1rem;">ðŸŽ¬ Try Sample Video</button>
            </div>
            
            <!-- Selected File Display -->
            <div class="selected-file" id="selectedFile" style="display: none;">
                <div class="file-info">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#4F46E5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14 2V8H20" stroke="#4F46E5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span id="fileName">video.mp4</span>
                </div>
                <button class="btn btn-success" id="analyzeBtn">Analyze Video</button>
            </div>
        </section>

        <!-- Loading Section -->
        <section class="loading-section" id="loadingSection" style="display: none;">
            <div class="spinner"></div>
            <h2>Analyzing Video...</h2>
            <p id="loadingStatus">Processing frames</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </section>

        <!-- Results Section -->
        <section class="results-section" id="resultsSection" style="display: none;">
            <h2>Analysis Results</h2>
            
            <!-- Performance Badge -->
            <div class="performance-badge" id="performanceBadge">
                âš¡ <span id="perfStats">0 frames in 0s</span>
            </div>

            <!-- Control Panel -->
            <div class="control-panel">
                <div class="control-group">
                    <label for="motionSlider">Motion Threshold: <span id="motionVal">1.5</span>x</label>
                    <input type="range" id="motionSlider" min="1.0" max="3.0" step="0.1" value="1.5">
                </div>
                <div class="control-group">
                    <label for="sharpnessSlider">Sharpness Threshold: <span id="sharpVal">100</span></label>
                    <input type="range" id="sharpnessSlider" min="50" max="200" step="10" value="100">
                </div>
                <button class="btn btn-primary" onclick="reAnalyze()">ðŸ”„ Re-Analyze</button>
            </div>
            
            <!-- Summary Cards -->
            <div class="summary-cards" id="summaryCards">
                <div class="card card-primary">
                    <div class="card-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                            <path d="M3 9H21" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="card-content">
                        <span class="card-value" id="totalFrames">0</span>
                        <span class="card-label">Total Frames</span>
                    </div>
                </div>
                
                <div class="card card-danger">
                    <div class="card-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="card-content">
                        <span class="card-value" id="dropsDetected">0</span>
                        <span class="card-label">Drops Detected</span>
                    </div>
                </div>
                
                <div class="card card-warning">
                    <div class="card-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 9V13M12 17H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <path d="M10.29 3.86L1.82 18C1.64 18.3 1.55 18.64 1.55 19C1.55 19.36 1.64 19.7 1.82 20C2 20.3 2.25 20.56 2.55 20.73C2.85 20.9 3.19 20.99 3.54 21H20.46C20.81 21 21.15 20.9 21.45 20.73C21.75 20.56 22 20.3 22.18 20C22.36 19.7 22.45 19.36 22.45 19C22.45 18.64 22.36 18.3 22.18 18L13.71 3.86C13.53 3.56 13.28 3.3 12.98 3.13C12.68 2.96 12.34 2.87 12 2.87C11.66 2.87 11.32 2.96 11.02 3.13C10.72 3.3 10.47 3.56 10.29 3.86Z" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="card-content">
                        <span class="card-value" id="mergesDetected">0</span>
                        <span class="card-label">Merges Detected</span>
                    </div>
                </div>
                
                <div class="card card-info">
                    <div class="card-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="card-content">
                        <span class="card-value" id="processingTime">0s</span>
                        <span class="card-label">Processing Time</span>
                    </div>
                </div>
            </div>

            <!-- Video Player with Timeline -->
            <div class="video-section">
                <!-- Interactive Timeline (moved above video for mobile) -->
                <div class="timeline-container">
                    <h3>Frame Timeline <span class="timeline-hint">(Click to jump to frame)</span></h3>
                    <div class="timeline-legend">
                        <span class="legend-item"><span class="legend-color normal"></span> Normal</span>
                        <span class="legend-item"><span class="legend-color drop"></span> Drop</span>
                        <span class="legend-item"><span class="legend-color merge"></span> Merge</span>
                    </div>
                    <div class="timeline-wrapper">
                        <canvas id="timelineCanvas"></canvas>
                        <div id="playhead" class="playhead"></div>
                    </div>
                    <div class="timeline-labels">
                        <span>Frame 0</span>
                        <span id="timelineEnd">End</span>
                    </div>
                </div>

                <!-- Video Player -->
                <div class="video-container">
                    <h3>Annotated Video</h3>
                    <div class="video-wrapper">
                        <video id="resultVideo" controls>
                            <source src="" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>

            <!-- Insights Box -->
            <div class="insights-box" id="insightsBox">
                <h3>ðŸ“Š Smart Insights</h3>
                <div id="insightsContent">
                    <p>Analysis pending...</p>
                </div>
            </div>

            <!-- FPS Chart -->
            <div class="chart-container">
                <h3>FPS Variation Chart</h3>
                <canvas id="fpsChart" height="80"></canvas>
                <p class="chart-caption">FPS drops indicate temporal inconsistencies.</p>
            </div>

            <!-- Error Density Chart -->
            <div class="chart-container">
                <h3>Error Density Heatmap</h3>
                <canvas id="densityChart" height="80"></canvas>
                <p class="chart-caption">Error density highlights problematic video segments.</p>
            </div>

            <!-- New Analysis Button -->
            <button class="btn btn-secondary" id="newAnalysisBtn">Analyze Another Video</button>
        </section>

        <!-- How It Works Section -->
        <section class="how-it-works" id="howItWorks">
            <h2>How It Works</h2>
            <div class="methods-grid">
                <div class="method-card">
                    <div class="method-icon drop-icon">
                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 8L8 24M8 8L20 24" stroke="white" stroke-width="3" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <h3>Frame Drop Detection</h3>
                    <p>Identifies missing frames through:</p>
                    <ul>
                        <li><strong>Timestamp Gaps:</strong> Detects irregular time intervals exceeding threshold</li>
                        <li><strong>Motion Discontinuity:</strong> Catches sudden jumps in frame-to-frame pixel differences</li>
                    </ul>
                </div>
                
                <div class="method-card">
                    <div class="method-icon merge-icon">
                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 16H24M16 8V24" stroke="white" stroke-width="3" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <h3>Frame Merge Detection</h3>
                    <p>Identifies duplicated/blended frames through:</p>
                    <ul>
                        <li><strong>Low Sharpness Analysis:</strong> Uses Laplacian variance to measure image clarity</li>
                        <li><strong>Threshold:</strong> Frames with variance below threshold are flagged</li>
                    </ul>
                </div>
                
                <div class="method-card">
                    <div class="method-icon visual-icon">
                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="2" y="6" width="28" height="20" rx="2" stroke="white" stroke-width="2"/>
                            <circle cx="10" cy="16" r="3" fill="white"/>
                            <path d="M16 12H26M16 16H24M16 20H22" stroke="white" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <h3>Visual Annotations</h3>
                    <p>Each frame is color-coded:</p>
                    <ul>
                        <li><span class="color-dot green"></span> <strong>Green:</strong> Normal frame</li>
                        <li><span class="color-dot red"></span> <strong>Red:</strong> Frame drop detected</li>
                        <li><span class="color-dot yellow"></span> <strong>Yellow:</strong> Frame merge detected</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>Video Temporal Error Detector &copy; 2024 | Built for Hackathons</p>
        </footer>
    </div>

    <!-- Frame Inspector Modal -->
    <div id="frameModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h3>Frame Inspector</h3>
            <div class="modal-body">
                <img id="frameThumb" src="" alt="Frame thumbnail">
                <div id="frameDetails">
                    <p><strong>Frame:</strong> <span id="frameNumber">0</span></p>
                    <p><strong>Status:</strong> <span id="frameStatus">Normal</span></p>
                    <p><strong>Confidence:</strong> <span id="frameConfidence">0%</span></p>
                    <p><strong>Timestamp:</strong> <span id="frameTimestamp">0ms</span></p>
                    <p><strong>Sharpness:</strong> <span id="frameSharpness">0</span></p>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/script.js"></script>
</body>
</html>
